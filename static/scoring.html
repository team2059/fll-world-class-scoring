<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>FLL</title>
        <style>
            body {
                background-color: #000;
                font-family: sans-serif;
            }
            .heading {
                color: #FFF;
            }
            .fll-mission {
                background-color: rgba(255,255,255,0.75);
                position: absolute;
                max-width: 25%;
                border: 5px solid #FFF;
                font-weight: bold;
                /*font-size: 0;*/
            }
            #board {
                background: url('/board');
                background-size: cover;
                position: relative;
                width:100%;
            }
            input[type="checkbox"] {
                width: 30px;
                height: 30px;
                vertical-align: middle;
            }
            .fll-mission label:after {
                content:"\A"; white-space:pre;
                font-size: 0;
            }
            span {
                display: inline-block;
            }
            .fll-mission input:nth-child(2) {
                display: block;
            }

            .menu-item {
                min-width: 20%;
                display: inline-block;
            }
            .right {
                max-width: 30%;
                text-align: right;
            }
            .right label:after {
                content:""; white-space:pre;
            }
            .right input:nth-child(2) {
                display: inline;
            }
            .right label:before {
                content:"\A"; white-space:pre;
            }
            h1 span {
                display: inline;
            }
            #mission-door {
                top: 50%;
                left:5%;
            }
            #mission-sd {
                top: 85%;
                left: 55%;
            }
            #mission-community {
                top: 80%;
                left: 75%;
            }
            #mission-insert {
                top: 35%;
                left: 65%;
            }
            #mission-senses {
                top: 10%;
                left: 65%;
            }
            #mission-ideas {
                top: 60%;
                right: 10%;
            }
            #mission-remote {
                top: 50%;
                left: 75%;
            }
            #mission-search {
                top: 10%;
                left: 35%;
            }
            #mission-spertz {
                top: 35%;
                left: 35%;
            }
            #mission-basket {
                top: 70%;
                left: 5%;
            }
            #mission-rotate {
                top: 70%;
                left: 35%;
            }
            #mission-apprenticeship {
                top: 10%;
                left: 5%;
            }
            #mission-pbl {
                left: 5%;
                top: 35%;
            }
        </style>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var run_data = {"door":0,"cloud":0,"community-learning":0,"robotics-insert":0,"robotics-loop":0,"senses":0,"thinking-outside-the-box":0,"bulb":0,"remote-learning":0,"search-slider":0,"search-loop":0,"sports-ball":0,"sports-net":0,"reverse-basket":0,"reverse-model":0,"changing-conditions":0,"apprenticeship-model":0,"apprenticeship-touching":0,"pb-learning":0,"pb-learning":0,"penalty":0};
            var run_values = {"door":15,"cloud":30,"community-learning":25,"robotics-insert":25,"robotics-loop":30,"senses":40,"thinking-outside-the-box":25,"bulb":15,"remote-learning":40,"search-slider":15,"search-loop":45,"sports-ball":30,"sports-net":30,"reverse-basket":30,"reverse-model":15,"changing-conditions":15,"apprenticeship-model":20,"apprenticeship-touching":15,"pb-learning":10,"penalty":-10}
            var socket = io();
            function findTable(){
                for (x in document.getElementsByName('table')){
                    if(document.getElementsByName('table')[x].checked == true){
                        return document.getElementsByName('table')[x].value;
                    }
                }
            }
            function newScore() {
                var score = 0;
                for (value in run_values){
                    score += run_data[value] * run_values[value];
                }
                var data = {}
                data["team"] = document.getElementById("team").value;
                data["table"] = findTable();
                data["score"] = score;
                socket.emit('score',JSON.stringify(data));
                return score;
            }
            function update(box){
                if (box.checked == true){
                    run_data[box.id]=1;
                }else{
                    run_data[box.id]=0;
                }
                document.getElementById("score").textContent = newScore();
            }
            function requireUpdate(box){
                if(box.checked == false){
                    for(var x = 0; x < box.parentNode.getElementsByTagName('input').length; x++){
                        box.parentNode.getElementsByTagName('input')[x].checked = false;
                        update(box.parentNode.getElementsByTagName('input')[x]);
                    };
                }else{
                    update(box);
                }
            }
            function supUpdate(box){
                if(box.checked == true){
                    if (box.parentNode.getElementsByTagName('input')[0].checked == true){
                        update(box)
                    }else{
                        box.checked = false;
                    }
                }else{
                    update(box);
                }
            }
            function numericUpdate(box){
                box.name = box.value;
                if (box.value > 8) {
                    box.name = 8;
                    box.value = 8;
                }
                if (box.value < 0) {
                    box.name = 0;
                    box.value = 0;
                }
                if (box.id == "pb-learning" && box.value>0){
                    box.name = parseInt(box.value) + 1;
                }
                run_data[box.id]=box.name;
                document.getElementById("score").textContent = newScore();
            }
            function reset(){
                for (var x = 0; x < document.getElementsByTagName('input').length; x++) {
                    if (document.getElementsByTagName('input')[x].type == "checkbox") {
                        document.getElementsByTagName('input')[x].checked = false;
                    }
                    if (document.getElementsByTagName('input')[x].type == "number") {
                        document.getElementsByTagName('input')[x].value = 0;
                        document.getElementsByTagName('input')[x].name = 0;
                    }
                    document.getElementById("score").textContent = 0;
                }
            }
            function send(button) {
                if (button.textContent == "Submit"){
                    var sendData = {"missions":{}}
                    sendData["missions"] = run_data;
                    sendData["team"] = document.getElementById("team").value;
                    sendData["table"] = findTable();
                    sendData["raw_score"] = newScore();
                    socket.emit('submit',JSON.stringify(sendData));
                    reset();
                    button.textContent = "Ready";
                } else{
                    if (findTable()==="undefined" || document.getElementById("team").value==""){
                        alert("Please input both a team and table");
                        return;
                    }
                    button.textContent = "Submit";
                    newScore();
                }
            }
        </script>
    </head>
    <body>
        <div class="heading">
            <p><div class="menu-item">Current Score: <span id="score">0</span></div>
            <div class="menu-item"><span>Team: <input type="text" id="team"></span></div>
            <div class="menu-item"><span>Table: <input type="radio" id="table" value="a" name="table">A<input type="radio" id="table" value="b" name="table">B<input type="radio" id="table" value="c" name="table">C<input type="radio" id="table" value="d" name="table">D</span></div>
            <div class="menu-item">Penalties.
                <span id="mission-touch"><input type="number" id="penalty" name="0" onchange="numericUpdate(this)"></span></div>
            <button type="submit" onclick="send(this)">Ready</button>
            <button type="reset" onclick="reset()">Reset</button>
            </p>
        </div>
    <div id="board">
        <span class="fll-mission" id="mission-door"><input type="checkbox" id="door" onchange="update(this)"><label for="door">Door opened.</label></span>
        <span class="fll-mission right" id="mission-sd"><label for="cloud">SD card is up.</label><input type="checkbox" id="cloud" onchange="update(this)"></span>
        <span class="fll-mission" id="mission-community"><input type="checkbox" id="community-learning" onchange="update(this)"><label for="community-learning">Loop no longer touching "Community Learning" model.</label></span>
        <span class="fll-mission" id="mission-insert"><input type="checkbox" id="robotics-insert" onchange="requireUpdate(this)"><label for="robotics-insert">Only robot insert installed.</label><input type="checkbox" id="robotics-loop" onchange="supUpdate(this)"><label for="robotics-loop">Loop no longer touching model.</label></span>
        <span class="fll-mission" id="mission-senses"><input type="checkbox" id="senses" onchange="update(this)"><label for="senses">Loop no longer touching "Senses" model.</label></span>
        <span class="fll-mission right" id="mission-ideas"><label for="thinking-outside-the-box">Idea module not touching box.</label><input type="checkbox" id="thinking-outside-the-box" onchange="requireUpdate(this)"><label for="bulb">Blub facing up.</label><input type="checkbox" id="bulb" onchange="supUpdate(this)"></span>
        <span class="fll-mission" id="mission-remote"><input type="checkbox" id="remote-learning" onchange="update(this)"><label for="remote-learning">Slider pulled west.</label></span>
        <span class="fll-mission" id="mission-search"><input type="checkbox" id="search-slider" onchange="requireUpdate(this)"><label for="search-slider">Wheel spun 1+ times.</label><input type="checkbox" id="search-loop" onchange="supUpdate(this)"><label for="search-loop">Only correct loop removed.</label></span>
        <span class="fll-mission" id="mission-spertz"><input type="checkbox" id="sports-ball" onchange="requireUpdate(this)"><label for="sports-ball">Ball shot.</label><input type="checkbox" id="sports-net" onchange="supUpdate(this)"><label for="sports-net">Touching mat in Net at end of match.</label></span>
        <span class="fll-mission" id="mission-basket"><input type="checkbox" id="reverse-basket" onchange="requireUpdate(this)"><label for="reverse-basket">Basket in base.</label><input type="checkbox" id="reverse-model" onchange="supUpdate(this)"><label for="reverse-model">Identical model in base.</label></span>
        <span class="fll-mission" id="mission-rotate"><input type="checkbox" id="changing-conditions" onchange="update(this)"><label for="changing-conditions">Model rotated 90-ish degrees CCS.</label></span>
        <span class="fll-mission" id="mission-apprenticeship"><input type="checkbox" id="apprenticeship-model" onchange="requireUpdate(this)"><label for="apprenticeship-model">Apprenticeship model presented to referee.</label><input type="checkbox" id="apprenticeship-touching" onchange="supUpdate(this)"><label for="apprenticeship-touching">Touching circle, not in base, people bound</label></span>
        <span class="fll-mission" id="mission-pbl"><input type="number" id="pb-learning" name="0" onchange="numericUpdate(this)"><label for="pb-learning">Loops on "Project-based Learning" scale.</label></span>
    </div>
    <div id="approve">
        <input type=text>
    </div>
    <script>
        var board = document.getElementById("board");
        function resize(){
            board.style.height = (board.offsetWidth/1.72)+"px";
        }
        window.onresize = function(event) {
            resize();
        }
        resize();
    </script>
    </body>
</html>